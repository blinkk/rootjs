import {describe, expect, it} from 'vitest';
import {shouldImageUseDarkBg} from './gcs.js';

describe('shouldImageUseDarkBg', () => {
  const testCases = [
    {
      name: 'black pixels and transparent background',
      expectedDarkBg: false,
      svg: `
<svg width="65" height="62" viewBox="0 0 65 62" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M44 18H55C56.1046 18 57 18.8954 57 20V31" stroke="black" stroke-width="2"/>
<path d="M21 54L10 54C8.89543 54 8 53.1046 8 52L8 41" stroke="black" stroke-width="2"/>
<path d="M57 41L57 52C57 53.1046 56.1046 54 55 54L44 54" stroke="black" stroke-width="2"/>
<path d="M8 31L8 20C8 18.8954 8.89543 18 10 18L21 18" stroke="black" stroke-width="2"/>
<path d="M38 28L50 45H26L38 28Z" fill="#34A853" stroke="#34A853" stroke-width="2" stroke-linejoin="round"/>
<path d="M24 32L33 45H15L24 32Z" fill="#34A853" stroke="#34A853" stroke-width="2" stroke-linejoin="round"/>
</svg>
`,
    },
    {
      name: 'mixed color SVG',
      expectedDarkBg: false,
      svg: `
<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2.83203 18.3502C2.83203 15.5402 5.10999 13.2622 7.91999 13.2622H52.9107C55.7207 13.2622 57.9987 15.5402 57.9987 18.3502V21.7421H2.83203V18.3502Z" fill="#FBBC04"/>
<rect x="3.83203" y="14.2622" width="53.1666" height="39.9756" rx="4.08796" stroke="black" stroke-width="2"/>
<mask id="path-3-outside-1_3446_36717" maskUnits="userSpaceOnUse" x="11.2012" y="29.7952" width="13" height="13" fill="black">
<rect fill="white" x="11.2012" y="29.7952" width="13" height="13"/>
<path d="M14.1821 36.3719L23.4401 40.224V41.8419L12.4358 36.9754V35.7427L23.4401 30.889V32.4941L14.1821 36.3719Z"/>
</mask>
<path d="M14.1821 36.3719L23.4401 40.224V41.8419L12.4358 36.9754V35.7427L23.4401 30.889V32.4941L14.1821 36.3719Z" fill="black"/>
<path d="M14.1821 36.3719L14.0838 36.1372L13.5218 36.3726L14.0844 36.6067L14.1821 36.3719ZM23.4401 40.224H23.6945V40.0543L23.5378 39.9891L23.4401 40.224ZM23.4401 41.8419L23.3372 42.0745L23.6945 42.2325V41.8419H23.4401ZM12.4358 36.9754H12.1814V37.141L12.3329 37.208L12.4358 36.9754ZM12.4358 35.7427L12.3332 35.5099L12.1814 35.5768V35.7427H12.4358ZM23.4401 30.889H23.6945V30.4988L23.3374 30.6562L23.4401 30.889ZM23.4401 32.4941L23.5383 32.7287L23.6945 32.6633V32.4941H23.4401ZM14.1821 36.3719L14.0844 36.6067L23.3423 40.4589L23.4401 40.224L23.5378 39.9891L14.2799 36.137L14.1821 36.3719ZM23.4401 40.224H23.1857V41.8419H23.4401H23.6945V40.224H23.4401ZM23.4401 41.8419L23.5429 41.6092L12.5387 36.7427L12.4358 36.9754L12.3329 37.208L23.3372 42.0745L23.4401 41.8419ZM12.4358 36.9754H12.6902V35.7427H12.4358H12.1814V36.9754H12.4358ZM12.4358 35.7427L12.5385 35.9754L23.5427 31.1218L23.4401 30.889L23.3374 30.6562L12.3332 35.5099L12.4358 35.7427ZM23.4401 30.889H23.1857V32.4941H23.4401H23.6945V30.889H23.4401ZM23.4401 32.4941L23.3418 32.2594L14.0838 36.1372L14.1821 36.3719L14.2804 36.6065L23.5383 32.7287L23.4401 32.4941Z" fill="black" mask="url(#path-3-outside-1_3446_36717)"/>
<mask id="path-5-outside-2_3446_36717" maskUnits="userSpaceOnUse" x="24.6348" y="25.7952" width="11" height="21" fill="black">
<rect fill="white" x="24.6348" y="25.7952" width="11" height="21"/>
<path d="M26.7585 46.4002H25.3204L33.1274 26.0995H34.5655L26.7585 46.4002Z"/>
</mask>
<path d="M26.7585 46.4002H25.3204L33.1274 26.0995H34.5655L26.7585 46.4002Z" fill="black"/>
<path d="M26.7585 46.4002V46.6546H26.9332L26.996 46.4915L26.7585 46.4002ZM25.3204 46.4002L25.0829 46.3089L24.95 46.6546H25.3204V46.4002ZM33.1274 26.0995V25.8451H32.9526L32.8899 26.0082L33.1274 26.0995ZM34.5655 26.0995L34.8029 26.1908L34.9359 25.8451H34.5655V26.0995ZM26.7585 46.4002V46.1458H25.3204V46.4002V46.6546H26.7585V46.4002ZM25.3204 46.4002L25.5578 46.4915L33.3648 26.1908L33.1274 26.0995L32.8899 26.0082L25.0829 46.3089L25.3204 46.4002ZM33.1274 26.0995V26.3539H34.5655V26.0995V25.8451H33.1274V26.0995ZM34.5655 26.0995L34.328 26.0082L26.5211 46.3089L26.7585 46.4002L26.996 46.4915L34.8029 26.1908L34.5655 26.0995Z" fill="black" mask="url(#path-5-outside-2_3446_36717)"/>
<mask id="path-7-outside-3_3446_36717" maskUnits="userSpaceOnUse" x="36.7832" y="29.7952" width="12" height="13" fill="black">
<rect fill="white" x="36.7832" y="29.7952" width="12" height="13"/>
<path d="M46.6738 36.3205L37.2361 32.4427V30.8633L48.4587 35.717V36.9497L37.2361 41.8162V40.2368L46.6738 36.3205Z"/>
</mask>
<path d="M46.6738 36.3205L37.2361 32.4427V30.8633L48.4587 35.717V36.9497L37.2361 41.8162V40.2368L46.6738 36.3205Z" fill="black"/>
<path d="M46.6738 36.3205L46.7714 36.5555L47.3404 36.3193L46.7705 36.0852L46.6738 36.3205ZM37.2361 32.4427H36.9817V32.6132L37.1395 32.678L37.2361 32.4427ZM37.2361 30.8633L37.3371 30.6298L36.9817 30.4761V30.8633H37.2361ZM48.4587 35.717H48.7131V35.5499L48.5596 35.4835L48.4587 35.717ZM48.4587 36.9497L48.5599 37.1831L48.7131 37.1166V36.9497H48.4587ZM37.2361 41.8162H36.9817V42.2038L37.3374 42.0496L37.2361 41.8162ZM37.2361 40.2368L37.1386 40.0019L36.9817 40.067V40.2368H37.2361ZM46.6738 36.3205L46.7705 36.0852L37.3328 32.2074L37.2361 32.4427L37.1395 32.678L46.5772 36.5558L46.6738 36.3205ZM37.2361 32.4427H37.4905V30.8633H37.2361H36.9817V32.4427H37.2361ZM37.2361 30.8633L37.1352 31.0968L48.3577 35.9505L48.4587 35.717L48.5596 35.4835L37.3371 30.6298L37.2361 30.8633ZM48.4587 35.717H48.2043V36.9497H48.4587H48.7131V35.717H48.4587ZM48.4587 36.9497L48.3575 36.7163L37.1349 41.5828L37.2361 41.8162L37.3374 42.0496L48.5599 37.1831L48.4587 36.9497ZM37.2361 41.8162H37.4905V40.2368H37.2361H36.9817V41.8162H37.2361ZM37.2361 40.2368L37.3337 40.4718L46.7714 36.5555L46.6738 36.3205L46.5763 36.0855L37.1386 40.0019L37.2361 40.2368Z" fill="black" mask="url(#path-7-outside-3_3446_36717)"/>
</svg>
`,
    },
    {
      name: 'blue logo SVG',
      expectedDarkBg: false,
      svg: `
<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6 31.2484C6 29.4444 6.3 27.6405 6.6 25.8366L21 40.268V43.2745C21 46.5817 23.7 49.2876 27 49.2876V55C15.3 53.4967 6 43.5752 6 31.2484ZM47.7 47.4837C46.8 45.0784 44.7 43.2745 42 43.2745H39V34.2549C39 32.451 37.8 31.2484 36 31.2484H18V25.2353H24C25.8 25.2353 27 24.0327 27 22.2288V16.2157H33C36.3 16.2157 39 13.5098 39 10.2026V9C47.7 12.6078 54 21.3268 54 31.2484C54 37.5621 51.6 43.2745 47.7 47.4837Z" fill="#4285F4"/>
<circle cx="30" cy="31" r="24" stroke="black" stroke-width="2"/>
</svg>
`,
    },
    {
      name: 'image with light pixels (white rect)',
      expectedDarkBg: true,
      svg: `
<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
  <rect width="100" height="100" fill="white" />
</svg>
`,
    },
    {
      name: 'blue logo SVG with white stroke',
      expectedDarkBg: true,
      svg: `
<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6 31.2484C6 29.4444 6.3 27.6405 6.6 25.8366L21 40.268V43.2745C21 46.5817 23.7 49.2876 27 49.2876V55C15.3 53.4967 6 43.5752 6 31.2484ZM47.7 47.4837C46.8 45.0784 44.7 43.2745 42 43.2745H39V34.2549C39 32.451 37.8 31.2484 36 31.2484H18V25.2353H24C25.8 25.2353 27 24.0327 27 22.2288V16.2157H33C36.3 16.2157 39 13.5098 39 10.2026V9C47.7 12.6078 54 21.3268 54 31.2484C54 37.5621 51.6 43.2745 47.7 47.4837Z" fill="#4285F4"/>
<circle cx="30" cy="31" r="24" stroke="white" stroke-width="2"/>
</svg>
`,
    },
    {
      name: 'mixed color SVG with white strokes/fills',
      expectedDarkBg: true,
      svg: `
<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2.83203 18.3502C2.83203 15.5402 5.10999 13.2622 7.91999 13.2622H52.9107C55.7207 13.2622 57.9987 15.5402 57.9987 18.3502V21.7421H2.83203V18.3502Z" fill="#FBBC04"/>
<rect x="3.83203" y="14.2622" width="53.1666" height="39.9756" rx="4.08796" stroke="white" stroke-width="2"/>
<mask id="path-3-outside-1_3446_36717" maskUnits="userSpaceOnUse" x="11.2012" y="29.7952" width="13" height="13" fill="white">
<rect fill="white" x="11.2012" y="29.7952" width="13" height="13"/>
<path d="M14.1821 36.3719L23.4401 40.224V41.8419L12.4358 36.9754V35.7427L23.4401 30.889V32.4941L14.1821 36.3719Z"/>
</mask>
<path d="M14.1821 36.3719L23.4401 40.224V41.8419L12.4358 36.9754V35.7427L23.4401 30.889V32.4941L14.1821 36.3719Z" fill="white"/>
<path d="M14.1821 36.3719L14.0838 36.1372L13.5218 36.3726L14.0844 36.6067L14.1821 36.3719ZM23.4401 40.224H23.6945V40.0543L23.5378 39.9891L23.4401 40.224ZM23.4401 41.8419L23.3372 42.0745L23.6945 42.2325V41.8419H23.4401ZM12.4358 36.9754H12.1814V37.141L12.3329 37.208L12.4358 36.9754ZM12.4358 35.7427L12.3332 35.5099L12.1814 35.5768V35.7427H12.4358ZM23.4401 30.889H23.6945V30.4988L23.3374 30.6562L23.4401 30.889ZM23.4401 32.4941L23.5383 32.7287L23.6945 32.6633V32.4941H23.4401ZM14.1821 36.3719L14.0844 36.6067L23.3423 40.4589L23.4401 40.224L23.5378 39.9891L14.2799 36.137L14.1821 36.3719ZM23.4401 40.224H23.1857V41.8419H23.4401H23.6945V40.224H23.4401ZM23.4401 41.8419L23.5429 41.6092L12.5387 36.7427L12.4358 36.9754L12.3329 37.208L23.3372 42.0745L23.4401 41.8419ZM12.4358 36.9754H12.6902V35.7427H12.4358H12.1814V36.9754H12.4358ZM12.4358 35.7427L12.5385 35.9754L23.5427 31.1218L23.4401 30.889L23.3374 30.6562L12.3332 35.5099L12.4358 35.7427ZM23.4401 30.889H23.1857V32.4941H23.4401H23.6945V30.889H23.4401ZM23.4401 32.4941L23.3418 32.2594L14.0838 36.1372L14.1821 36.3719L14.2804 36.6065L23.5383 32.7287L23.4401 32.4941Z" fill="white" mask="url(#path-3-outside-1_3446_36717)"/>
<mask id="path-5-outside-2_3446_36717" maskUnits="userSpaceOnUse" x="24.6348" y="25.7952" width="11" height="21" fill="white">
<rect fill="white" x="24.6348" y="25.7952" width="11" height="21"/>
<path d="M26.7585 46.4002H25.3204L33.1274 26.0995H34.5655L26.7585 46.4002Z"/>
</mask>
<path d="M26.7585 46.4002H25.3204L33.1274 26.0995H34.5655L26.7585 46.4002Z" fill="white"/>
<path d="M26.7585 46.4002V46.6546H26.9332L26.996 46.4915L26.7585 46.4002ZM25.3204 46.4002L25.0829 46.3089L24.95 46.6546H25.3204V46.4002ZM33.1274 26.0995V25.8451H32.9526L32.8899 26.0082L33.1274 26.0995ZM34.5655 26.0995L34.8029 26.1908L34.9359 25.8451H34.5655V26.0995ZM26.7585 46.4002V46.1458H25.3204V46.4002V46.6546H26.7585V46.4002ZM25.3204 46.4002L25.5578 46.4915L33.3648 26.1908L33.1274 26.0995L32.8899 26.0082L25.0829 46.3089L25.3204 46.4002ZM33.1274 26.0995V26.3539H34.5655V26.0995V25.8451H33.1274V26.0995ZM34.5655 26.0995L34.328 26.0082L26.5211 46.3089L26.7585 46.4002L26.996 46.4915L34.8029 26.1908L34.5655 26.0995Z" fill="white" mask="url(#path-5-outside-2_3446_36717)"/>
<mask id="path-7-outside-3_3446_36717" maskUnits="userSpaceOnUse" x="36.7832" y="29.7952" width="12" height="13" fill="white">
<rect fill="white" x="36.7832" y="29.7952" width="12" height="13"/>
<path d="M46.6738 36.3205L37.2361 32.4427V30.8633L48.4587 35.717V36.9497L37.2361 41.8162V40.2368L46.6738 36.3205Z"/>
</mask>
<path d="M46.6738 36.3205L37.2361 32.4427V30.8633L48.4587 35.717V36.9497L37.2361 41.8162V40.2368L46.6738 36.3205Z" fill="white"/>
<path d="M46.6738 36.3205L46.7714 36.5555L47.3404 36.3193L46.7705 36.0852L46.6738 36.3205ZM37.2361 32.4427H36.9817V32.6132L37.1395 32.678L37.2361 32.4427ZM37.2361 30.8633L37.3371 30.6298L36.9817 30.4761V30.8633H37.2361ZM48.4587 35.717H48.7131V35.5499L48.5596 35.4835L48.4587 35.717ZM48.4587 36.9497L48.5599 37.1831L48.7131 37.1166V36.9497H48.4587ZM37.2361 41.8162H36.9817V42.2038L37.3374 42.0496L37.2361 41.8162ZM37.2361 40.2368L37.1386 40.0019L36.9817 40.067V40.2368H37.2361ZM46.6738 36.3205L46.7705 36.0852L37.3328 32.2074L37.2361 32.4427L37.1395 32.678L46.5772 36.5558L46.6738 36.3205ZM37.2361 32.4427H37.4905V30.8633H37.2361H36.9817V32.4427H37.2361ZM37.2361 30.8633L37.1352 31.0968L48.3577 35.9505L48.4587 35.717L48.5596 35.4835L37.3371 30.6298L37.2361 30.8633ZM48.4587 35.717H48.2043V36.9497H48.4587H48.7131V35.717H48.4587ZM48.4587 36.9497L48.3575 36.7163L37.1349 41.5828L37.2361 41.8162L37.3374 42.0496L48.5599 37.1831L48.4587 36.9497ZM37.2361 41.8162H37.4905V40.2368H37.2361H36.9817V41.8162H37.2361ZM37.2361 40.2368L37.3337 40.4718L46.7714 36.5555L46.6738 36.3205L46.5763 36.0855L37.1386 40.0019L37.2361 40.2368Z" fill="white" mask="url(#path-7-outside-3_3446_36717)"/>
</svg>
`,
    },
  ];

  testCases.forEach(({name, expectedDarkBg, svg}) => {
    it(`should return ${
      expectedDarkBg ? 'true (dark bg)' : 'false (light bg)'
    } for ${name}`, async () => {
      const file = new File([svg], 'test.svg', {type: 'image/svg+xml'});
      const result = await shouldImageUseDarkBg(file);
      expect(result).toBe(expectedDarkBg);
    });
  });
});
